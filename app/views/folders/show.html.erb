<% if current_user %>

  <aside class="sidebar">
    <% unless current_page?(folder_path("archive")) %>
      <%= link_to("Download", download_folder_path(params[:permalink]), target: "_blank", class: "button primary") %>
    <% end %>
    <nav class="widget" itemscope itemtype="https://schema.org/SiteNavigationElement">
      <%= link_to folder_path("unread"), class: ("active" if current_page?(folder_path("unread"))), itemprop: "url" do %>
        <%= inline_svg('home.svg') %>Home
      <% end %>
      <%= link_to folder_path("archive"), class: ("active" if current_page?(folder_path("archive"))), itemprop: "url" do %>
        <%= inline_svg('archive.svg') %>Archive
      <% end %>
    </nav>
  </aside>

  <main class="main">

    <% unless current_page?(folder_path("archive")) %>
      <%= form_with(model: @article, url: articles_path, local: true, html: { class: 'article-add' }) do |form| %>
        <%= form.fields_for 'article' do |link| %>
          <%= link.label :link, class: "screen-reader-text" %>
          <%= link.text_field :link, class: "article-add__input" %>
        <% end %>
        <%= hidden_field_tag 'folder', params[:permalink] %>
        <%= form.submit "Add Article", class: "button primary" %>
      <% end %>
    <% end %>

    <div id="articles" data-folder="<%= @folder.id %>">
      <% Array(@articles.order(:position)).each do |article| %>
        <div class="article" data-id="<%= article.id %>">
          <div class="sort-title-wrapper">
            <% unless current_page?(folder_path("archive")) %>
              <%= image_tag "sort.svg", class: "sort" %>
            <% end %>
            <div class="title-wrapper">
              <p class="title"><%= article.title %></p>
              <p class="link text-muted"><small><%= link_to article.link, article.link %></small></p>
            </div>
          </div>
          <div class="archive-delete-wrapper">
            <% unless current_page?(folder_path("archive")) %>
              <%= link_to image_tag("archive.svg"), archive_article_path(article), method: :patch, class: "archive" %>
            <% end %>
            <% unless current_page?(folder_path("unread")) %>
              <%= link_to image_tag("home.svg"), unarchive_article_path(article), method: :patch, class: "archive" %>
            <% end %>
            <%= link_to image_tag("trash.svg"), article_path(article), method: :delete, data: { confirm: "Are you sure you want to permanently delete this article?" }, class: "delete" %>
          </div>
        </div>
      <% end %>
    </div>

  </main>

<% else %>
  <main class="main">
    <%= render "layouts/signin" %>
  </main>
<% end %>
